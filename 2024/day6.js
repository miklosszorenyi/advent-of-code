const test_input = [
  '....#.....',
  '.........#',
  '..........',
  '..#.......',
  '.......#..',
  '..........',
  '.#..^.....',
  '........#.',
  '#.........',
  '......#...',
];

const final_input = [
  '......#........#.............#.##..........................................#.......#...#........#......................#..........',
  '.......................#...#................................#..#.........................................#.....#.....#............',
  '.......................................#.................#..................#....#........................................#.......',
  '.............#...................#.#...............................#....#....#.#.......................................#..#.......',
  '...............................#........##.#..............................#..............................#..#...#..#..............',
  '........................#......................................................................................#..#...............',
  '............................#..........#.......#...................#.....#..................#.....................#..##...........',
  '......................................................##........................#..............#........#..............#..#...#...',
  '............................#.............................................##..........................................#...........',
  '..........#............#....................................#...........#......................................................#..',
  '....#......#.........................................#.......#...............................#..#.##..................#........#..',
  '........................#.#..........##.#..........#......#.......#............................................................#..',
  '..........................................................................................#.#..........................#..........',
  '.............................#............#.......................#................#....................................#.........',
  '...................................#.........................#.............#......#...#................................#.....#....',
  '..........#..................#..#.....................#...#...#.........................................#................#........',
  '....#....#...........#...#..........................................#.............#..#......#................#.....#..............',
  '....................................................................................#......#....##..##....#.......................',
  '...........................#......................#.........##................#............#.......................#...#..........',
  '...........................#....................#............................................#........#.........................#.',
  '..#......#.......#.#...........................#......#....#.#...#.............................#............#..............#......',
  '.......#................#...................................#.........................#..................................#........',
  '..................................................................#...........................................................#...',
  '......................#....#........................................................................................#.............',
  '...#..................#.......#......................................................................#.#....................#.....',
  '................#....................................#.........#..#.........................#...............#.......#.............',
  '.......................................#.................#..................................#...#...........#.....................',
  '....#.....###..................#........#...#..............#............#...............................................#.........',
  '...................#.......................................................#...................................#..................',
  '....#......................................#...##.....#........#......#......#..........................................#.........',
  '......................#............#...............#................#...............................#.............................',
  '......................#..............................................#...........#............#.................................#.',
  '#.#..............................#..#......#.............#.......#......................#...........#........#..........#.........',
  '....#....#.......................................#.......................................................#........................',
  '.......#............................#...........................#.........................#...............#.......................',
  '.....................................#........#.....#........#.......................#...............#..........................#.',
  '....#.......................................#........#......................................................#.................#...',
  '............#..............#...#.......#..#.................................................................................##...#',
  '...#..................#...................#....#............................................................................#.....',
  '.....#....................#...............#.............................................#.....#...............................#...',
  '..............................#.......................#.................#.......................................................#.',
  '.........#....................#..............................................................................#.................#..',
  '......#..................#.........................#.......#.....#...........#....#...................................#......#....',
  '.........#...#......................#......#.................#.........................................#...................#......',
  '....#....#.................................#..#..#........#............................................#.......#..................',
  '....................#...........................#...#............#...........................#....................................',
  '................#................#....#.......................................#....#..........#.#.#..........#....................',
  '....#............................#...................................#.....................................................#.#....',
  '....................................#............#......................#......................##.....................#.......#...',
  '.........................#...................................#.....#................................................#.............',
  '...........#.#..#............................................................................#.#..................................',
  '....#......#.#..................................................#..#....#...#..#...................................#..............',
  '#.........................#.#.................................................................#.#.............................#...',
  '..................#...#........#.......................................................#....#..............................#...#..',
  '.........#..........#.............................................................................................#...............',
  '....................................................................#.......................#..#............#............#........',
  '.................#.................#.............................................#..................................#.............',
  '.#...................................................................................................#................#...........',
  '...#....#.#.#.........#............#..............................................................................................',
  '..................#...#......................................#...#.............#....#....#................#.......................',
  '.....#................................##....................................................................#.....................',
  '............#..................#......#....................#.....#.#.........................##............#............#.......#.',
  '............................#..#.................#.............................................#..................................',
  '............#...............#..........................................................#........#.................................',
  '.......#.......#.......................................##..............##.........................................................',
  '....................#.........#.....#..............#....#.......................................................#.................',
  '...#............................................................#.............................................#...#............#..',
  '....#..............................#...............................#..........................................#...................',
  '............................................................................................................#....................#',
  '..#.............................................................................................................#............#....',
  '..........#...............#.........................................................#...........#.................................',
  '...............#.....................#....................................#....................#.....#...#.....................#..',
  '.#......#.........................................................................................#..#............................',
  '......#..............#........#........#........#.........................................................#.......................',
  '............................#...........#..#.............................................................................#........',
  '..................#..............#.......................................#.........#...............#.....................#.#......',
  '...........................................#.##...................................................................................',
  '.......................#.............................................................................................#............',
  '..........#................................#......#..............................#.................#........#......#.#.........#..',
  '#.......#........................#.....#..........##......#................#......................................#..#..#......#..',
  '........................##........................#....................#......................................#.................#.',
  '..........................#.#........................................................................................#............',
  '..........#.........#.....#......#............#..#................................................##.................#............',
  '........#.....#............##...........................................#..#...............................................#.....#',
  '..............#.......#......................#.....#.......................#.........#........#.................#...#....#........',
  '..............#.................................#.................................................##..............................',
  '................................#........#...........#........................................................#...................',
  '..#.#..................#....#......#..............................#.....#....#.#.............#...............................#....',
  '.....................................................................#......#.........#.......#.........................#....#..#.',
  '.#..........................#.....#...........................................##..^.#..........................#....#....#....#...',
  '...........................#..#................................................................#...#........#.........#...........',
  '......#.................#..............#................#.........#........................#..#........#......#...................',
  '.....#..................#..........#............................................................................#.#...........#...',
  '..........#.........#.................................#......#....#...............#.....................#...#.....................',
  '...........#.......#...........#..#...............#...#..............#...........................................#................',
  '..............................................................#...................................................................',
  '................#..............#.....................#.......#.....................................................#..............',
  '#................#.......#.#..............................#..........................#.............................#..........#...',
  '.#...#.........##..........#......................#....#.........#....................#...............................#.....#.....',
  '....#......#.................#....................................#...............................................................',
  '......#..........#...............................................................#....#...............#.....#.##..................',
  '............................................................#..................#..#...................#.....#.....................',
  '......................#.......#...#....#....................................#.............................#............#..........',
  '.#.............#.....................#...............#.......#...............##.....#..................##...#.....................',
  '........#........................................................###.#..........................................#.................',
  '...##.#................................................................................................#..........................',
  '.............##................#.............#....................#....#......................#........................#.....#....',
  '..#.......#............................................#...............................................#..........................',
  '.................#....#.......................................................#............#..#........................#.......#.#',
  '...#..#......................#............#........#...........................................................................#..',
  '....................................#.......................#.....................................#.....#..#......................',
  '.#...............#......#...........#.....#........##....#.......#.....#...................................................#......',
  '...................#...#............................#..##........#...........................#...........#........................',
  '....................#.#.....................................................................................#......#..............',
  '....#...........#....#...#...#.....................#............................................#..............#..................',
  '......#.#......#................#......................................#...............#..........................................',
  '.......#.#................#..............#.....................#.#......#..................#......................................',
  '.....#................................#..............#.......#......##........#................................#..........#.......',
  '.....................................#......#.........#...#.....#..........#..........................#...........................',
  '......#.......#............................................................#..#....................#...............#.........#....',
  '.........................#...........#.............#......#..#..............................................................#.....',
  '.........#.......##.....#....................................#.....#..............#......#.......#..................##.........#..',
  '.........................#...................#...#.....#...........................................#.................#..#.........',
  '...........#..........#.......................................................................................................#..#',
  '.....#................................................#...........................................................#....#..........',
  '..............#.................................#.............#.........................................................#.........',
  '............#.........................................................#.....#...............................................#.....',
  '..................................................#.................#.............................#....#...#.........#.......#....',
  '........#................#................................................................#................#....................#.',
  '..................##............................###.........#.......#................#........#......#............#...............',
];

function part1(input) {
  const guard = '^';
  const visitedCoords = [];

  let y = input.findIndex(row => row.includes(guard));
  let x = input[y].indexOf(guard);
  let next = null;
  const movedirs = ['up', 'right', 'down', 'left'];
  let moveindex = 0;
  let index = [y, x];
  let nextIndex = [y, x];
  let score = 0;
  let step = 0;
  let loop = false;
  const loopLimit = input.length * input[0].length;

  while (next !== undefined) {
    let dir = movedirs[moveindex];

    if (dir == 'up') {
      nextIndex = [y -= 1, x];
    } else if (dir == 'right') {
      nextIndex = [y, x += 1];
    } else if (dir == 'down') {
      nextIndex = [y += 1, x];
    } else if (dir == 'left') {
      nextIndex = [y, x -= 1];
    }

    if (nextIndex[0] < 0 || nextIndex[0] >= input.length || nextIndex[1] < 0 || nextIndex[1] >= input[0].length) {
      // console.log('out of bounds');
      break;
    }

    next = input[nextIndex[0]][nextIndex[1]];

    if (next == '#') {
      moveindex = (moveindex + 1) % 4;
      x = index[1];
      y = index[0];
    } else {
      const coord = `${y}-${x}`;
      if (!visitedCoords.includes(coord)) {
        visitedCoords.push(coord)
        score++;
      };
      index = nextIndex;
    }

    if (step++ > loopLimit) {
      loop = true;
      break;
    }
  }

  return [score, loop];
}

function part2(input) {
  let stuckedCnt = 0;

  input.forEach((row, y) => {
    row.split('').forEach((cell, x) => {
      if (input[y][x] == '.') {
        r = input[y].split('');
        r[x] = '#';
        input[y] = r.join('');

        if (part1(input)[1]) {
          stuckedCnt++;
        }

        r = input[y].split('');
        r[x] = '.';
        input[y] = r.join('');
      }
    });
  });

  return stuckedCnt;
}

console.log(part2(final_input));